(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{26471:(e,a,t)=>{"use strict";t.d(a,{default:()=>h});var i=t(95155),s=t(12115),r=t(67943),n=t(99045);t(52626);let l=e=>e.filter(e=>null!==e.published_at),c=e=>{let{label:a,value:t,className:s=""}=e;return(0,i.jsxs)("div",{className:"metric-card ".concat(s),children:[(0,i.jsx)("div",{className:"metric-label",children:a}),(0,i.jsx)("div",{className:"metric-value",children:t})]})},o=e=>{let{data:a,xKey:t="x",yKey:s="y"}=e,n=[{id:"data",data:a.map(e=>({x:e[t],y:e[s]}))}];return(0,i.jsx)(r.bt,{data:n,margin:{top:20,right:20,bottom:60,left:60},xScale:{type:"point"},yScale:{type:"linear",min:"auto",max:"auto",stacked:!1,reverse:!1},curve:"monotoneX",axisTop:null,axisRight:null,axisBottom:{tickSize:5,tickPadding:5,tickRotation:-45,legend:"",legendOffset:36,legendPosition:"middle"},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,legend:"Quantidade",legendOffset:-50,legendPosition:"middle"},colors:{scheme:"category10"},pointSize:8,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},pointLabelYOffset:-12,useMesh:!0,enableArea:!0,areaOpacity:.1,legends:[]})},d=e=>{let{data:a,indexBy:t,keys:s,colors:r={scheme:"nivo"}}=e;return(0,i.jsx)(n.ED,{data:a,keys:s,indexBy:t,margin:{top:20,right:20,bottom:60,left:60},padding:.3,valueScale:{type:"linear"},indexScale:{type:"band",round:!0},colors:r,borderColor:{from:"color",modifiers:[["darker",1.6]]},axisTop:null,axisRight:null,axisBottom:{tickSize:5,tickPadding:5,tickRotation:-45,legend:"",legendPosition:"middle",legendOffset:32},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,legend:"Quantidade",legendPosition:"middle",legendOffset:-50},labelSkipWidth:12,labelSkipHeight:12,labelTextColor:{from:"color",modifiers:[["darker",1.6]]},legends:[],role:"application",ariaLabel:"Bar chart"})};function h(){let[e,a]=(0,s.useState)(!0),[t,r]=(0,s.useState)(null),[n,h]=(0,s.useState)({totalUsers:0,totalCheckins:0,checkinsPerDay:[],checkinsPerActivation:[],usersPerDay:[],ageDistribution:[],clientIntention:[],averageSurveyRating:"0",activationsByTime:[]});return((0,s.useEffect)(()=>{(async()=>{try{var e,t,i,s,n,c,o,d,u,m,v,p,x;a(!0);let g=await fetch("".concat("https://api-rac-n-play.vercel.app/api/data","/all"));if(!g.ok)throw Error("HTTP error! status: ".concat(g.status));let j=await g.json(),b=(null==(t=j.tables)||null==(e=t.up_users)?void 0:e.data)||[],f=l((null==(s=j.tables)||null==(i=s.checkins)?void 0:i.data)||[]),k=l((null==(c=j.tables)||null==(n=c.ativacoes)?void 0:n.data)||[]),N=l((null==(d=j.tables)||null==(o=d.pesquisa_experiencias)?void 0:o.data)||[]),y=(null==(m=j.tables)||null==(u=m.checkins_ativacao_lnk)?void 0:u.data)||[],D={totalUsers:(x=(null==(p=j.tables)||null==(v=p.checkins_users_permissions_user_lnk)?void 0:v.data)||[],new Set(x.map(e=>e.user_id)).size),totalCheckins:f.length,checkinsPerDay:(e=>{let a={};return e.forEach(e=>{let t=new Date(e.created_at).toLocaleDateString("pt-BR");a[t]=(a[t]||0)+1}),Object.entries(a).map(e=>{let[a,t]=e;return{date:a,count:t}}).sort((e,a)=>new Date(e.date).getTime()-new Date(a.date).getTime())})(f),checkinsPerActivation:((e,a,t)=>{let i={};return a.forEach(e=>{i[e.id]={name:e.nome,count:0}}),t.forEach(e=>{let a=i[e.ativacao_id];a&&(a.count+=1)}),Object.values(i).filter(e=>e.count>0).sort((e,a)=>a.count-e.count)})(0,k,y),usersPerDay:(e=>{let a={};return e.forEach(e=>{let t=new Date(e.created_at).toLocaleDateString("pt-BR");a[t]=(a[t]||0)+1}),Object.entries(a).map(e=>{let[a,t]=e;return{date:a,count:t}}).sort((e,a)=>new Date(e.date).getTime()-new Date(a.date).getTime())})(b),ageDistribution:(e=>{let a={};return e.forEach(e=>{var t;let i=null==(t=e.pergunta_resposta)?void 0:t.find(e=>{var a;return null==(a=e.pergunta)?void 0:a.includes("idade")});if(null==i?void 0:i.resposta){let e=i.resposta;a[e]=(a[e]||0)+1}}),Object.entries(a).map(e=>{let[a,t]=e;return{age:a,count:t}})})(N),clientIntention:(e=>{let a={Cliente:0,"N\xe3o Cliente":0};return e.forEach(e=>{var t;let i=null==(t=e.pergunta_resposta)?void 0:t.find(e=>{var a;return null==(a=e.pergunta)?void 0:a.includes("Cliente BB")});(null==i?void 0:i.resposta)==="Sim"?a.Cliente+=1:(null==i?void 0:i.resposta)==="N\xe3o"&&(a["N\xe3o Cliente"]+=1)}),Object.entries(a).map(e=>{let[a,t]=e;return{type:a,count:t}})})(N),averageSurveyRating:(e=>{if(0===e.length)return"0";let a=0,t=0;return e.forEach(e=>{var i;let s=null==(i=e.pergunta_resposta)?void 0:i.find(e=>{var a;return null==(a=e.pergunta)?void 0:a.includes("experi\xeancia no espa\xe7o")});if(null==s?void 0:s.resposta){let e=Number.parseInt(s.resposta.charAt(0));isNaN(e)||(a+=e,t+=1)}}),t>0?(a/t).toFixed(2):"0"})(N),activationsByTime:(e=>{let a={};return e.forEach(e=>{let t=new Date(e.created_at).getHours(),i="".concat(t,":00");a[i]=(a[i]||0)+1}),Object.entries(a).map(e=>{let[a,t]=e;return{time:a,count:t}}).sort((e,a)=>Number.parseInt(e.time)-Number.parseInt(a.time))})(f)};h(D),r(null)}catch(e){r("Erro ao carregar dados do dashboard. Por favor, tente novamente."),console.error("Dashboard error:",e)}finally{a(!1)}})()},[]),e)?(0,i.jsx)("div",{className:"dashboard-container",children:(0,i.jsx)("div",{className:"loading-container",children:(0,i.jsx)("div",{className:"loading-spinner"})})}):t?(0,i.jsx)("div",{className:"dashboard-container",children:(0,i.jsxs)("div",{className:"error-container",children:[(0,i.jsx)("strong",{children:"Erro:"})," ",t]})}):(0,i.jsxs)("div",{className:"dashboard-container",children:[(0,i.jsxs)("div",{className:"dashboard-header",children:[(0,i.jsx)("h1",{className:"dashboard-title",children:"Dashboard Rec'n'Play"}),(0,i.jsx)("p",{className:"dashboard-subtitle",children:"Banco do Brasil - An\xe1lise de Eventos e Ativa\xe7\xf5es"})]}),(0,i.jsxs)("div",{className:"metrics-grid",children:[(0,i.jsx)(c,{label:"Usu\xe1rios com Ativa\xe7\xf5es",value:n.totalUsers}),(0,i.jsx)(c,{label:"Total de Check-ins",value:n.totalCheckins}),(0,i.jsx)(c,{label:"Ativa\xe7\xf5es Dispon\xedveis",value:n.checkinsPerActivation.length}),(0,i.jsx)(c,{label:"Nota M\xe9dia das Pesquisas",value:n.averageSurveyRating,className:"survey-rating-card"})]}),(0,i.jsxs)("div",{className:"charts-grid",children:[(0,i.jsxs)("div",{className:"chart-card",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Check-ins por Dia"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(o,{data:n.checkinsPerDay,xKey:"date",yKey:"count"})})]}),(0,i.jsxs)("div",{className:"chart-card",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Check-ins por Ativa\xe7\xe3o"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(d,{data:n.checkinsPerActivation,indexBy:"name",keys:["count"],colors:{scheme:"set2"}})})]}),(0,i.jsxs)("div",{className:"chart-card full-width-chart",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Usu\xe1rios Cadastrados por Dia"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(o,{data:n.usersPerDay,xKey:"date",yKey:"count"})})]}),(0,i.jsxs)("div",{className:"chart-card",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Distribui\xe7\xe3o por Faixa Et\xe1ria"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(d,{data:n.ageDistribution,indexBy:"age",keys:["count"],colors:{scheme:"paired"}})})]}),(0,i.jsxs)("div",{className:"chart-card",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Inten\xe7\xe3o de Relacionamento (Clientes vs N\xe3o Clientes)"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(d,{data:n.clientIntention,indexBy:"type",keys:["count"],colors:{scheme:"accent"}})})]}),(0,i.jsxs)("div",{className:"chart-card full-width-chart",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Picos de Hor\xe1rio das Ativa\xe7\xf5es"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(d,{data:n.activationsByTime,indexBy:"time",keys:["count"],colors:{scheme:"category10"}})})]})]})]})}},52626:()=>{},64592:(e,a,t)=>{Promise.resolve().then(t.bind(t,26471))}},e=>{e.O(0,[301,843,441,255,358],()=>e(e.s=64592)),_N_E=e.O()}]);