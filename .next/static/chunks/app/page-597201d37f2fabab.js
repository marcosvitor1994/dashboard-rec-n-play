(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{26471:(e,a,t)=>{"use strict";t.d(a,{default:()=>u});var i=t(95155),s=t(12115),r=t(67943),n=t(99045);t(52626);let l=e=>e.filter(e=>null!==e.published_at),o=e=>{let{label:a,value:t,className:s=""}=e;return(0,i.jsxs)("div",{className:"metric-card ".concat(s),children:[(0,i.jsx)("div",{className:"metric-label",children:a}),(0,i.jsx)("div",{className:"metric-value",children:t})]})},d=e=>{let{data:a,xKey:t="x",yKey:s="y"}=e,n=[{id:"data",data:a.map(e=>({x:e[t],y:e[s]}))}];return(0,i.jsx)(r.bt,{data:n,margin:{top:20,right:20,bottom:60,left:60},xScale:{type:"point"},yScale:{type:"linear",min:"auto",max:"auto",stacked:!1,reverse:!1},curve:"monotoneX",axisTop:null,axisRight:null,axisBottom:{tickSize:5,tickPadding:5,tickRotation:-45,legend:"",legendOffset:36,legendPosition:"middle"},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,legend:"Quantidade",legendOffset:-50,legendPosition:"middle"},colors:{scheme:"category10"},pointSize:8,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},pointLabelYOffset:-12,useMesh:!0,enableArea:!0,areaOpacity:.1,legends:[]})},c=e=>{let{data:a,indexBy:t,keys:s,colors:r={scheme:"nivo"}}=e;return(0,i.jsx)(n.ED,{data:a,keys:s,indexBy:t,margin:{top:20,right:20,bottom:60,left:60},padding:.3,valueScale:{type:"linear"},indexScale:{type:"band",round:!0},colors:r,borderColor:{from:"color",modifiers:[["darker",1.6]]},axisTop:null,axisRight:null,axisBottom:{tickSize:5,tickPadding:5,tickRotation:-45,legend:"",legendPosition:"middle",legendOffset:32},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,legend:"Quantidade",legendPosition:"middle",legendOffset:-50},labelSkipWidth:12,labelSkipHeight:12,labelTextColor:{from:"color",modifiers:[["darker",1.6]]},legends:[],role:"application",ariaLabel:"Bar chart"})};function u(){var e,a;let[t,r]=(0,s.useState)(!0),[n,u]=(0,s.useState)(null),[h,m]=(0,s.useState)({totalUsers:0,totalCheckins:0,totalResgates:0,checkinsPerDay:[],checkinsPerActivation:[],usersPerDay:[],ageDistribution:[],clientIntention:[],averageSurveyRating:"0",activationsByTime:[],surveyQuestions:[],activations:[],avaliacoes:[]}),[v,p]=(0,s.useState)(void 0),[g,x]=(0,s.useState)(""),[f,j]=(0,s.useState)(""),[b,y]=(0,s.useState)([]),[k,N]=(0,s.useState)("0"),[_,S]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{try{var e,a,t,i,s,n,o,d,c,h,v,p,g,x,f,j,b,k;r(!0);let _=await fetch("https://api-rac-n-play.vercel.app/api/data/all");if(!_.ok)throw Error("HTTP error! status: ".concat(_.status));let D=await _.json(),R=(null==(a=D.tables)||null==(e=a.up_users)?void 0:e.data)||[],B=l((null==(i=D.tables)||null==(t=i.checkins)?void 0:t.data)||[]),w=l((null==(n=D.tables)||null==(s=n.ativacoes)?void 0:s.data)||[]),C=l((null==(d=D.tables)||null==(o=d.pesquisa_experiencias)?void 0:o.data)||[]),P=l((null==(h=D.tables)||null==(c=h.resgates)?void 0:c.data)||[]),E=l((null==(p=D.tables)||null==(v=p.avaliacao_de_ativacaos)?void 0:v.data)||[]),A=(null==(x=D.tables)||null==(g=x.checkins_ativacao_lnk)?void 0:g.data)||[],T=(null==(j=D.tables)||null==(f=j.checkins_users_permissions_user_lnk)?void 0:f.data)||[],z=(null==(k=D.tables)||null==(b=k.avaliacao_de_ativacaos_ativacao_lnk)?void 0:b.data)||[];S({checkins:B,checkinActivationLinks:A,avaliacoes:E,avaliacaoAtivacaoLinks:z});let O={totalUsers:new Set(T.map(e=>e.user_id)).size,totalCheckins:B.length,totalResgates:P.length,checkinsPerDay:(e=>{let a={};return e.forEach(e=>{let t=new Date(e.created_at).toLocaleDateString("pt-BR");a[t]=(a[t]||0)+1}),Object.entries(a).map(e=>{let[a,t]=e;return{date:a,count:t}}).sort((e,a)=>new Date(e.date).getTime()-new Date(a.date).getTime())})(B),checkinsPerActivation:((e,a,t)=>{let i={};return a.forEach(e=>{i[e.id]={name:e.nome,count:0}}),t.forEach(e=>{let a=i[e.ativacao_id];a&&(a.count+=1)}),Object.values(i).filter(e=>e.count>0).sort((e,a)=>a.count-e.count)})(0,w,A),usersPerDay:(e=>{let a={};return e.forEach(e=>{let t=new Date(e.created_at).toLocaleDateString("pt-BR");a[t]=(a[t]||0)+1}),Object.entries(a).map(e=>{let[a,t]=e;return{date:a,count:t}}).sort((e,a)=>new Date(e.date).getTime()-new Date(a.date).getTime())})(R),ageDistribution:(e=>{let a={};return e.forEach(e=>{var t;let i=null==(t=e.pergunta_resposta)?void 0:t.find(e=>{var a;return null==(a=e.pergunta)?void 0:a.includes("idade")});if(null==i?void 0:i.resposta){let e=i.resposta;a[e]=(a[e]||0)+1}}),Object.entries(a).map(e=>{let[a,t]=e;return{age:a,count:t}})})(C),clientIntention:(e=>{let a={Cliente:0,"N\xe3o Cliente":0};return e.forEach(e=>{var t;let i=null==(t=e.pergunta_resposta)?void 0:t.find(e=>{var a;return null==(a=e.pergunta)?void 0:a.includes("Cliente BB")});(null==i?void 0:i.resposta)==="Sim"?a.Cliente+=1:(null==i?void 0:i.resposta)==="N\xe3o"&&(a["N\xe3o Cliente"]+=1)}),Object.entries(a).map(e=>{let[a,t]=e;return{type:a,count:t}})})(C),averageSurveyRating:(e=>{if(0===e.length)return"0";let a=0,t=0;return e.forEach(e=>{var i;let s=null==(i=e.pergunta_resposta)?void 0:i.find(e=>{var a;return null==(a=e.pergunta)?void 0:a.includes("experi\xeancia no espa\xe7o")});if(null==s?void 0:s.resposta){let e=Number.parseInt(s.resposta.charAt(0));isNaN(e)||(a+=e,t+=1)}}),t>0?(a/t).toFixed(2):"0"})(C),activationsByTime:(e=>{let a={};return e.forEach(e=>{let t=new Date(e.created_at).getHours(),i="".concat(t,":00");a[i]=(a[i]||0)+1}),Object.entries(a).map(e=>{let[a,t]=e;return{time:a,count:t}}).sort((e,a)=>Number.parseInt(e.time)-Number.parseInt(a.time))})(B),surveyQuestions:(e=>{let a={};return e.forEach(e=>{e.pergunta_resposta&&Array.isArray(e.pergunta_resposta)&&e.pergunta_resposta.forEach(e=>{if(e.pergunta&&e.resposta){let t=e.pergunta,i=e.resposta.match(/^(\d+)/);if(i){let e=parseInt(i[1]);a[t]||(a[t]={total:0,count:0}),a[t].total+=e,a[t].count+=1}}})}),Object.entries(a).map(e=>{let[a,{total:t,count:i}]=e;return{pergunta:a,media:i>0?Number((t/i).toFixed(2)):0,totalRespostas:i}}).filter(e=>e.totalRespostas>0)})(C),activations:w.map(e=>({id:e.id,nome:e.nome})),avaliacoes:E.map(e=>({id:e.id,nota:e.nota,ativacao_id:0,created_at:e.created_at}))};m(O),y(O.activationsByTime),N(O.averageSurveyRating),u(null)}catch(e){u("Erro ao carregar dados do dashboard. Por favor, tente novamente."),console.error("Dashboard error:",e)}finally{r(!1)}})()},[]),(0,s.useEffect)(()=>{if(!_)return;let e=g?new Date(g):void 0,a=f?new Date(f):void 0;y(((e,a,t,i,s)=>{let r=e;if(t){let e=a.filter(e=>e.ativacao_id===t).map(e=>e.checkin_id);r=r.filter(a=>e.includes(a.id))}(i||s)&&(r=r.filter(e=>{let a=new Date(e.created_at);return(!i||!(a<i))&&(!s||!(a>s))}));let n={};return r.forEach(e=>{let a=new Date(e.created_at).getHours(),t="".concat(a,":00");n[t]=(n[t]||0)+1}),Object.entries(n).map(e=>{let[a,t]=e;return{time:a,count:t}}).sort((e,a)=>parseInt(e.time)-parseInt(a.time))})(_.checkins,_.checkinActivationLinks,v,e,a)),N(((e,a,t)=>{let i=e;if(t){let s=a.filter(e=>e.ativacao_id===t).map(e=>e.avaliacao_de_ativacao_id);i=e.filter(e=>s.includes(e.id))}return 0===i.length?"0":(i.reduce((e,a)=>e+(a.nota||0),0)/i.length).toFixed(2)})(_.avaliacoes,_.avaliacaoAtivacaoLinks,v))},[v,g,f,_]),t)?(0,i.jsx)("div",{className:"dashboard-container",children:(0,i.jsx)("div",{className:"loading-container",children:(0,i.jsx)("div",{className:"loading-spinner"})})}):n?(0,i.jsx)("div",{className:"dashboard-container",children:(0,i.jsxs)("div",{className:"error-container",children:[(0,i.jsx)("strong",{children:"Erro:"})," ",n]})}):(0,i.jsxs)("div",{className:"dashboard-container",children:[(0,i.jsxs)("div",{className:"dashboard-header",children:[(0,i.jsx)("h1",{className:"dashboard-title",children:"Dashboard Rec'n'Play"}),(0,i.jsx)("p",{className:"dashboard-subtitle",children:"Banco do Brasil - An\xe1lise de Eventos e Ativa\xe7\xf5es"})]}),(0,i.jsxs)("div",{className:"metrics-grid",children:[(0,i.jsx)(o,{label:"Usu\xe1rios com Ativa\xe7\xf5es",value:h.totalUsers}),(0,i.jsx)(o,{label:"Total de Check-ins",value:h.totalCheckins}),(0,i.jsx)(o,{label:"Total de Resgates",value:h.totalResgates}),(0,i.jsx)(o,{label:"Ativa\xe7\xf5es Dispon\xedveis",value:h.checkinsPerActivation.length}),(0,i.jsx)(o,{label:"Nota M\xe9dia das Pesquisas",value:h.averageSurveyRating,className:"survey-rating-card"})]}),(0,i.jsxs)("div",{className:"filters-section",style:{marginBottom:"2rem",padding:"1.5rem",background:"#fff",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,i.jsx)("h3",{style:{marginBottom:"1rem",fontSize:"1.2rem",fontWeight:600},children:"Filtros"}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:500},children:"Ativa\xe7\xe3o"}),(0,i.jsxs)("select",{value:v||"",onChange:e=>p(e.target.value?Number(e.target.value):void 0),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ddd"},children:[(0,i.jsx)("option",{value:"",children:"Todas as ativa\xe7\xf5es"}),h.activations.map(e=>(0,i.jsx)("option",{value:e.id,children:e.nome},e.id))]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:500},children:"Data In\xedcio"}),(0,i.jsx)("input",{type:"date",value:g,onChange:e=>x(e.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ddd"}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:500},children:"Data Fim"}),(0,i.jsx)("input",{type:"date",value:f,onChange:e=>j(e.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ddd"}})]})]}),(v||g||f)&&(0,i.jsx)("div",{style:{marginTop:"1rem"},children:(0,i.jsx)("button",{onClick:()=>{p(void 0),x(""),j("")},style:{padding:"0.5rem 1rem",background:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:"Limpar Filtros"})})]}),v&&(0,i.jsxs)("div",{style:{marginBottom:"2rem",padding:"1.5rem",background:"#fff",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,i.jsxs)("h3",{style:{marginBottom:"0.5rem",fontSize:"1.2rem",fontWeight:600},children:["M\xe9dia de Avalia\xe7\xf5es - ",null==(e=h.activations.find(e=>e.id===v))?void 0:e.nome]}),(0,i.jsx)("div",{style:{fontSize:"2rem",fontWeight:700,color:"#1976d2"},children:k})]}),(0,i.jsxs)("div",{className:"charts-grid",children:[(0,i.jsxs)("div",{className:"chart-card",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Check-ins por Dia"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(d,{data:h.checkinsPerDay,xKey:"date",yKey:"count"})})]}),(0,i.jsxs)("div",{className:"chart-card",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Check-ins por Ativa\xe7\xe3o"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(c,{data:h.checkinsPerActivation,indexBy:"name",keys:["count"],colors:{scheme:"set2"}})})]}),(0,i.jsxs)("div",{className:"chart-card",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Distribui\xe7\xe3o por Faixa Et\xe1ria"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(c,{data:h.ageDistribution,indexBy:"age",keys:["count"],colors:{scheme:"paired"}})})]}),(0,i.jsxs)("div",{className:"chart-card",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Inten\xe7\xe3o de Relacionamento (Clientes vs N\xe3o Clientes)"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(c,{data:h.clientIntention,indexBy:"type",keys:["count"],colors:{scheme:"accent"}})})]}),(0,i.jsxs)("div",{className:"chart-card full-width-chart",children:[(0,i.jsx)("h2",{className:"chart-title",children:"Usu\xe1rios Cadastrados por Dia"}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(d,{data:h.usersPerDay,xKey:"date",yKey:"count"})})]}),(0,i.jsxs)("div",{className:"chart-card full-width-chart",children:[(0,i.jsxs)("h2",{className:"chart-title",children:["Picos de Hor\xe1rio das Ativa\xe7\xf5es",v&&" - ".concat(null==(a=h.activations.find(e=>e.id===v))?void 0:a.nome),(g||f)&&" (Filtrado)"]}),(0,i.jsx)("div",{className:"chart-container",children:(0,i.jsx)(c,{data:b,indexBy:"time",keys:["count"],colors:{scheme:"category10"}})})]}),(0,i.jsxs)("div",{className:"chart-card full-width-chart",children:[(0,i.jsx)("h2",{className:"chart-title",children:"An\xe1lise de Perguntas da Pesquisa de Experi\xeancias"}),(0,i.jsx)("div",{style:{padding:"1rem"},children:h.surveyQuestions.length>0?(0,i.jsx)("div",{style:{display:"grid",gap:"1rem"},children:h.surveyQuestions.map((e,a)=>(0,i.jsxs)("div",{style:{padding:"1rem",background:"#f5f5f5",borderRadius:"8px",borderLeft:"4px solid #1976d2"},children:[(0,i.jsx)("div",{style:{fontWeight:600,marginBottom:"0.5rem",color:"#333"},children:e.pergunta}),(0,i.jsxs)("div",{style:{display:"flex",gap:"2rem",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{style:{fontSize:"0.9rem",color:"#666"},children:"M\xe9dia: "}),(0,i.jsx)("span",{style:{fontSize:"1.5rem",fontWeight:700,color:"#1976d2"},children:e.media.toFixed(2)})]}),(0,i.jsxs)("div",{style:{fontSize:"0.9rem",color:"#666"},children:["Total de respostas: ",e.totalRespostas]})]})]},a))}):(0,i.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#666"},children:"Nenhuma pergunta com respostas num\xe9ricas encontrada"})})]})]})]})}},52626:()=>{},64592:(e,a,t)=>{Promise.resolve().then(t.bind(t,26471))}},e=>{e.O(0,[301,843,441,255,358],()=>e(e.s=64592)),_N_E=e.O()}]);